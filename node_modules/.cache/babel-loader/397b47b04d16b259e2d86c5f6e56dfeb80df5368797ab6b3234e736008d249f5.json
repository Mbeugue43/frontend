{"ast":null,"code":"// src/api/endpoint.js\nimport axios from \"axios\";\n\n// =================== BASE URL ===================\nconst BASE_URL = process.env.REACT_APP_API_BASE_URL || \"http://localhost:5000/api\";\n\n// =================== TOKEN MANAGEMENT ===================\nconst TOKEN_KEY = \"token\";\nexport const getAuthToken = () => localStorage.getItem(TOKEN_KEY);\nexport const setAuthToken = token => localStorage.setItem(TOKEN_KEY, token);\nexport const removeAuthToken = () => localStorage.removeItem(TOKEN_KEY);\n\n// =================== AXIOS INSTANCE ===================\nexport const axiosInstance = axios.create({\n  baseURL: BASE_URL,\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n});\n\n// Ajouter le token automatiquement Ã  chaque requÃªte\naxiosInstance.interceptors.request.use(config => {\n  const token = getAuthToken();\n  if (token) config.headers.Authorization = `Bearer ${token}`;\n  return config;\n}, error => Promise.reject(error));\n\n// =================== DECODE JWT ===================\nexport const decodeToken = token => {\n  if (!token) return null;\n  try {\n    const base64Url = token.split('.')[1];\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));\n    return JSON.parse(jsonPayload);\n  } catch {\n    return null;\n  }\n};\nexport const isTokenValid = token => {\n  if (!token) return false;\n  const decoded = decodeToken(token);\n  return decoded && decoded.exp * 1000 > Date.now();\n};\n\n// =================== ERROR HANDLER ===================\nexport const handleApiError = error => {\n  if (!error.response) return new Error(\"Erreur rÃ©seau ou serveur indisponible\");\n  const {\n    status,\n    data\n  } = error.response;\n  if (status === 401) {\n    removeAuthToken();\n    window.location.href = \"/login\";\n    return new Error(\"Session expirÃ©e. Redirection vers login...\");\n  }\n  if (status === 403) return new Error(data.message || \"ðŸ”’ AccÃ¨s refusÃ©\");\n  if (status === 404) return new Error(\"ðŸ“ Endpoint non trouvÃ©\");\n\n  // MongoDB doublon\n  if ((data === null || data === void 0 ? void 0 : data.errorName) === 'MongoServerError' && data.code === 11000) {\n    return new Error(\"âš ï¸ DonnÃ©es en doublon\");\n  }\n\n  // Validation errors\n  if (data !== null && data !== void 0 && data.validationErrors) {\n    const errors = Object.values(data.validationErrors).map(err => err.message).join(\"; \");\n    return new Error(`Validation: ${errors}`);\n  }\n  return new Error((data === null || data === void 0 ? void 0 : data.message) || `Erreur ${status}`);\n};\n\n// =================== API METHODS ===================\nexport const getData = async (endpoint, params = {}) => {\n  try {\n    const res = await axiosInstance.get(endpoint, {\n      params\n    });\n    return res.data;\n  } catch (err) {\n    throw handleApiError(err);\n  }\n};\nexport const postData = async (endpoint, payload) => {\n  try {\n    const res = await axiosInstance.post(endpoint, payload);\n    return res.data;\n  } catch (err) {\n    throw handleApiError(err);\n  }\n};\nexport const putData = async (endpoint, payload) => {\n  try {\n    const res = await axiosInstance.put(endpoint, payload);\n    return res.data;\n  } catch (err) {\n    throw handleApiError(err);\n  }\n};\nexport const deleteData = async endpoint => {\n  try {\n    const res = await axiosInstance.delete(endpoint);\n    return res.data;\n  } catch (err) {\n    throw handleApiError(err);\n  }\n};\n\n// =================== EXPORT DEFAULT ===================\nexport default {\n  getAuthToken,\n  setAuthToken,\n  removeAuthToken,\n  decodeToken,\n  isTokenValid,\n  getData,\n  postData,\n  putData,\n  deleteData\n};","map":{"version":3,"names":["axios","BASE_URL","process","env","REACT_APP_API_BASE_URL","TOKEN_KEY","getAuthToken","localStorage","getItem","setAuthToken","token","setItem","removeAuthToken","removeItem","axiosInstance","create","baseURL","headers","interceptors","request","use","config","Authorization","error","Promise","reject","decodeToken","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","isTokenValid","decoded","exp","Date","now","handleApiError","response","Error","status","data","window","location","href","message","errorName","code","validationErrors","errors","Object","values","err","getData","endpoint","params","res","get","postData","payload","post","putData","put","deleteData","delete"],"sources":["C:/Users/mbeug/OneDrive/Desktop/GOVAIMED1/frontend/govaimed_frontend/src/api/endpoint.js"],"sourcesContent":["// src/api/endpoint.js\r\nimport axios from \"axios\";\r\n\r\n// =================== BASE URL ===================\r\nconst BASE_URL = process.env.REACT_APP_API_BASE_URL || \"http://localhost:5000/api\";\r\n\r\n// =================== TOKEN MANAGEMENT ===================\r\nconst TOKEN_KEY = \"token\";\r\n\r\nexport const getAuthToken = () => localStorage.getItem(TOKEN_KEY);\r\nexport const setAuthToken = (token) => localStorage.setItem(TOKEN_KEY, token);\r\nexport const removeAuthToken = () => localStorage.removeItem(TOKEN_KEY);\r\n\r\n// =================== AXIOS INSTANCE ===================\r\nexport const axiosInstance = axios.create({\r\n  baseURL: BASE_URL,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\"\r\n  }\r\n});\r\n\r\n// Ajouter le token automatiquement Ã  chaque requÃªte\r\naxiosInstance.interceptors.request.use((config) => {\r\n  const token = getAuthToken();\r\n  if (token) config.headers.Authorization = `Bearer ${token}`;\r\n  return config;\r\n}, (error) => Promise.reject(error));\r\n\r\n// =================== DECODE JWT ===================\r\nexport const decodeToken = (token) => {\r\n  if (!token) return null;\r\n  try {\r\n    const base64Url = token.split('.')[1];\r\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n    const jsonPayload = decodeURIComponent(\r\n      atob(base64)\r\n        .split('')\r\n        .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\r\n        .join('')\r\n    );\r\n    return JSON.parse(jsonPayload);\r\n  } catch {\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const isTokenValid = (token) => {\r\n  if (!token) return false;\r\n  const decoded = decodeToken(token);\r\n  return decoded && decoded.exp * 1000 > Date.now();\r\n};\r\n\r\n// =================== ERROR HANDLER ===================\r\nexport const handleApiError = (error) => {\r\n  if (!error.response) return new Error(\"Erreur rÃ©seau ou serveur indisponible\");\r\n\r\n  const { status, data } = error.response;\r\n\r\n  if (status === 401) {\r\n    removeAuthToken();\r\n    window.location.href = \"/login\";\r\n    return new Error(\"Session expirÃ©e. Redirection vers login...\");\r\n  }\r\n\r\n  if (status === 403) return new Error(data.message || \"ðŸ”’ AccÃ¨s refusÃ©\");\r\n  if (status === 404) return new Error(\"ðŸ“ Endpoint non trouvÃ©\");\r\n\r\n  // MongoDB doublon\r\n  if (data?.errorName === 'MongoServerError' && data.code === 11000) {\r\n    return new Error(\"âš ï¸ DonnÃ©es en doublon\");\r\n  }\r\n\r\n  // Validation errors\r\n  if (data?.validationErrors) {\r\n    const errors = Object.values(data.validationErrors)\r\n      .map(err => err.message)\r\n      .join(\"; \");\r\n    return new Error(`Validation: ${errors}`);\r\n  }\r\n\r\n  return new Error(data?.message || `Erreur ${status}`);\r\n};\r\n\r\n// =================== API METHODS ===================\r\nexport const getData = async (endpoint, params = {}) => {\r\n  try {\r\n    const res = await axiosInstance.get(endpoint, { params });\r\n    return res.data;\r\n  } catch (err) {\r\n    throw handleApiError(err);\r\n  }\r\n};\r\n\r\nexport const postData = async (endpoint, payload) => {\r\n  try {\r\n    const res = await axiosInstance.post(endpoint, payload);\r\n    return res.data;\r\n  } catch (err) {\r\n    throw handleApiError(err);\r\n  }\r\n};\r\n\r\nexport const putData = async (endpoint, payload) => {\r\n  try {\r\n    const res = await axiosInstance.put(endpoint, payload);\r\n    return res.data;\r\n  } catch (err) {\r\n    throw handleApiError(err);\r\n  }\r\n};\r\n\r\nexport const deleteData = async (endpoint) => {\r\n  try {\r\n    const res = await axiosInstance.delete(endpoint);\r\n    return res.data;\r\n  } catch (err) {\r\n    throw handleApiError(err);\r\n  }\r\n};\r\n\r\n// =================== EXPORT DEFAULT ===================\r\nexport default {\r\n  getAuthToken,\r\n  setAuthToken,\r\n  removeAuthToken,\r\n  decodeToken,\r\n  isTokenValid,\r\n  getData,\r\n  postData,\r\n  putData,\r\n  deleteData\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}